<!DOCTYPE html>
<html lang="en" class="">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/asset/logo/logo.png" type="image/png">
    <meta name="description" content="<%= description %>">
    <meta name="keywords" content="<%= keywords %>">
    <title>
        <%= app_name %>
    </title>

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="<%= app_name %>">
    <meta property="og:description" content="<%= description %>">
    <meta property="og:image" content="https://angelwingspowerassembly.org/asset/images/banner.png">
    <meta property="og:image:alt" content="Angel Wings Power Assembly Logo">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://<%= url %>">
    <meta property="og:site_name" content="<%= app_name %>">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="<%= app_name %>">
    <meta name="twitter:description" content="<%= description %>">
    <meta name="twitter:image" content="/asset/images/banner.png">
    <meta name="twitter:image:alt" content="Angel Wings Power Assembly Logo">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="/css/font-awesome.min.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Puritan:ital,wght@0,400;0,700;1,400;1,700&family=Raleway:ital,wght@0,100..900;1,100..900&family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="/css/tailwind.css">

    <style>
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .modal {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }

        .modal.hidden {
            opacity: 0;
            transform: translateY(-20px);
        }

        table {
            table-layout: fixed;
            width: 100%;
        }

        @media (max-width: 640px) {

            th,
            td {
                font-size: 0.75rem;
                padding: 0.5rem;
            }

            .truncate-mobile {
                max-width: 100px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .action-btn {
                padding: 0.25rem;
                min-width: 44px;
                min-height: 44px;
            }
        }
    </style>
</head>

<body class="font-roboto bg-white dark:bg-black text-dark dark:text-white">
    <div class="min-h-screen flex bg-grey-200 dark:bg-dark-blue-900">
        <!-- Sidebar -->
        <div id="sidebar"
            class="w-64 bg-dark-blue-900 text-white flex flex-col fixed inset-y-0 left-0 transform transition-transform duration-300 ease-in-out md:translate-x-0 z-30">
            <div class="p-4 flex items-center gap-2">
                <svg class="w-8 h-8 text-red-900" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z">
                    </path>
                </svg>
                <h1 class="text-xl font-roboto font-bold">Church Admin</h1>
            </div>
            <nav class="flex-1 p-4 scrollbar-hide overflow-y-auto"
                style="-ms-overflow-style: none; scrollbar-width: none;">
                <a href="/admin" class="flex items-center gap-3 p-3 rounded-xl hover:bg-dark-blue-800 text-white mb-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                        </path>
                    </svg>
                    <span class="font-roboto">Dashboard</span>
                </a>
                <a href="/events" class="flex items-center gap-3 p-3 rounded-xl hover:bg-dark-blue-800 text-white mb-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                        </path>
                    </svg>
                    <span class="font-roboto">Events</span>
                </a>
                <a href="/blog" class="flex items-center gap-3 p-3 rounded-xl hover:bg-dark-blue-800 text-white mb-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253">
                        </path>
                    </svg>
                    <span class="font-roboto">Articles</span>
                </a>
                <a href="/media" class="flex items-center gap-3 p-3 rounded-xl bg-red-900 text-white mb-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 0 00-2 2v12a2 2 0 002 2z">
                        </path>
                    </svg>
                    <span class="font-roboto">Media</span>
                </a>
                <a href="/admin/subscribers"
                    class="flex items-center gap-3 p-3 rounded-xl hover:bg-dark-blue-800 text-white mb-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z">
                        </path>
                    </svg>
                    <span class="font-roboto">Subscribers</span>
                </a>
                <a href="/admin/testimonies"
                    class="flex items-center gap-3 p-3 rounded-xl hover:bg-dark-blue-800 text-white mb-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z">
                        </path>
                    </svg>
                    <span class="font-roboto">Testimonies</span>
                </a>
                <a href="/admin/church-details"
                    class="flex items-center gap-3 p-3 rounded-xl hover:bg-dark-blue-800 text-white mb-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a2 2 0 012-2h2a2 2 0 012 2v5m-4 0h4">
                        </path>
                    </svg>
                    <span class="font-roboto">Church Details</span>
                </a>
                <a href="/auth/logout"
                    class="flex items-center gap-3 p-3 rounded-xl hover:bg-dark-blue-800 text-white mb-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1">
                        </path>
                    </svg>
                    <span class="font-roboto">Logout</span>
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 ml-0 md:ml-64">
            <!-- Top Bar -->
            <header class="bg-white dark:bg-dark-blue-800 shadow p-4 flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <button id="menuBtn" class="md:hidden text-dark dark:text-white focus:outline-none"
                        aria-label="Toggle sidebar">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                    <h2 class="text-xl font-roboto font-bold text-dark-blue-900 dark:text-white">Media</h2>
                </div>
                <div class="flex items-center gap-4">
                    <span class="text-dark dark:text-grey-200 font-roboto">Admin User</span>
                    <img src="/asset/logo/logo.png" alt="User Avatar" class="w-10 h-10 rounded-full object-cover">
                </div>
            </header>

            <!-- Content Area -->
            <main class="p-4 sm:p-6 dark:bg-dark-blue-900 min-h-[calc(100vh-64px)]">
                <!-- Messages -->
                <% if (success) { %>
                    <div class="mb-4 p-4 bg-green-100 text-green-900 rounded-xl font-roboto text-sm">
                        <%= success %>
                    </div>
                    <% } %>
                        <% if (error) { %>
                            <div class="mb-4 p-4 bg-red-100 text-red-900 rounded-xl font-roboto text-sm">
                                <%= error %>
                            </div>
                            <% } %>

                                <!-- Header -->
                                <div class="flex flex-col sm:flex-row justify-between items-center mb-6">
                                    <h1
                                        class="text-xl sm:text-3xl font-roboto font-bold text-dark-blue-900 dark:text-white">
                                        Manage Media</h1>
                                    <button id="addMediaBtn"
                                        class="bg-red-900 text-white px-4 py-2 rounded-xl hover:bg-red-800 flex items-center gap-2 font-roboto uppercase transition-colors min-h-[44px]">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M12 4v16m8-8H4"></path>
                                        </svg>
                                        Add Media
                                    </button>
                                </div>

                                <!-- Pagination Summary -->
                                <div class="mb-4 text-grey-900 dark:text-grey-200 text-sm sm:text-base">
                                    <p>Showing <%= (page - 1) * perPage + 1 %>â€“<%= Math.min(page * perPage, total) %> of
                                                <%= total %> media items</p>
                                </div>

                                <!-- Media Table -->
                                <div
                                    class="bg-white dark:bg-dark-blue-800 rounded-xl shadow-lg overflow-x-auto scrollbar-hide">
                                    <table class="w-full text-left">
                                        <thead>
                                            <tr class="bg-dark-blue-900 text-white text-xs sm:text-sm">
                                                <th class="p-2 sm:p-4 font-roboto font-semibold cursor-pointer w-[5%]"
                                                    data-sort="index">No.</th>
                                                <th class="p-2 sm:p-4 font-roboto font-semibold cursor-pointer w-[25%]"
                                                    data-sort="title">Title</th>
                                                <th class="p-2 sm:p-4 font-roboto font-semibold cursor-pointer w-[15%]"
                                                    data-sort="type">Type</th>
                                                <th class="p-2 sm:p-4 font-roboto font-semibold cursor-pointer w-[15%]"
                                                    data-sort="status">Status</th>
                                                <th class="p-2 sm:p-4 font-roboto font-semibold cursor-pointer w-[15%]"
                                                    data-sort="priceStatus">Price</th>
                                                <th class="p-2 sm:p-4 font-roboto font-semibold w-[25%]">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% if (media && media.length> 0) { %>
                                                <% media.forEach((item, index)=> { %>
                                                    <tr
                                                        class="text-xs sm:text-sm border-b dark:border-dark-blue-600 hover:bg-grey-100 dark:hover:bg-dark-blue-700">
                                                        <td
                                                            class="p-2 sm:p-4 text-dark-blue-900 dark:text-grey-200 font-roboto">
                                                            <%= (page - 1) * perPage + index + 1 %>
                                                        </td>
                                                        <td
                                                            class="p-2 sm:p-4 text-dark-blue-900 dark:text-grey-200 font-roboto truncate truncate-mobile">
                                                            <%= item.title %>
                                                        </td>
                                                        <td
                                                            class="p-2 sm:p-4 text-dark-blue-900 dark:text-grey-200 font-roboto capitalize">
                                                            <%= item.type %>
                                                        </td>
                                                        <td
                                                            class="p-2 sm:p-4 text-dark-blue-900 dark:text-grey-200 font-roboto capitalize">
                                                            <%= item.status %>
                                                        </td>
                                                        <td
                                                            class="p-2 sm:p-4 text-dark-blue-900 dark:text-grey-200 font-roboto">
                                                            <%= item.priceStatus==='free' ? 'Free' : `$${item.price}` %>
                                                        </td>
                                                        <td class="p-2 sm:p-4 flex flex-col sm:flex-row gap-2">
                                                            <button
                                                                class="updateMediaBtn bg-light-blue-900 text-white px-3 py-1 rounded-lg hover:bg-light-blue-800 flex items-center gap-2 font-roboto action-btn"
                                                                data-id="<%= item._id %>" data-title="<%= item.title %>"
                                                                data-description="<%= item.description %>"
                                                                data-type="<%= item.type %>"
                                                                data-status="<%= item.status %>"
                                                                data-tags="<%= item.tags.join(',') %>"
                                                                data-category="<%= item.category %>"
                                                                data-price-status="<%= item.priceStatus %>"
                                                                data-price="<%= item.price %>"
                                                                data-author="<%= item.author %>"
                                                                aria-label="Edit media">
                                                                <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                                    viewBox="0 0 24 24">
                                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                                        stroke-width="2"
                                                                        d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15.828l-5.657-5.657a2 2 0 112.828-2.828l2.829 2.829">
                                                                    </path>
                                                                </svg>
                                                                Edit
                                                            </button>
                                                            <button
                                                                class="toggleStatusBtn bg-yellow-900 text-white px-3 py-1 rounded-lg hover:bg-yellow-800 flex items-center gap-2 font-roboto action-btn"
                                                                data-id="<%= item._id %>"
                                                                data-status="<%= item.status %>"
                                                                aria-label="Toggle media status">
                                                                <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                                    viewBox="0 0 24 24">
                                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                                        stroke-width="2"
                                                                        d="M6 12h12m-12 0l6-6m-6 6l6 6"></path>
                                                                </svg>
                                                                Toggle Status
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    <% }) %>
                                                        <% } else { %>
                                                            <tr>
                                                                <td colspan="6"
                                                                    class="p-4 text-center text-grey-600 dark:text-grey-400 font-roboto text-sm">
                                                                    No media found.
                                                                </td>
                                                            </tr>
                                                            <% } %>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Pagination -->
                                <% if (totalPages> 1) { %>
                                    <div class="mt-6 flex flex-col sm:flex-row items-center justify-between gap-4">
                                        <a href="?page=<%= page > 1 ? page - 1 : 1 %>"
                                            class="w-full sm:w-auto bg-dark-blue-900 text-white px-3 py-2 rounded-lg hover:bg-dark-blue-800 transition-colors font-roboto text-sm min-h-[44px] text-center <%= page === 1 ? 'opacity-50 cursor-not-allowed' : '' %>"
                                            aria-label="Previous page">
                                            Previous
                                        </a>
                                        <div class="flex flex-wrap gap-2 justify-center">
                                            <% const maxPages=5; %>
                                                <% const startPage=Math.max(1, page - 2); %>
                                                    <% const endPage=Math.min(totalPages, startPage + maxPages - 1); %>
                                                        <% if (startPage> 1) { %>
                                                            <a href="?page=1"
                                                                class="px-3 py-1 rounded-lg font-roboto text-sm bg-grey-200 text-grey-900 hover:bg-grey-300 min-h-[44px] flex items-center"
                                                                aria-label="Page 1">1</a>
                                                            <% if (startPage> 2) { %>
                                                                <span
                                                                    class="px-3 py-1 font-roboto text-sm text-grey-900">...</span>
                                                                <% } %>
                                                                    <% } %>
                                                                        <% for (let i=startPage; i <=endPage; i++) { %>
                                                                            <a href="?page=<%= i %>"
                                                                                class="px-3 py-1 rounded-lg font-roboto text-sm <%= page === i ? 'bg-red-900 text-white' : 'bg-grey-200 text-grey-900 hover:bg-grey-300' %> min-h-[44px] flex items-center"
                                                                                aria-label="Page <%= i %>">
                                                                                <%= i %>
                                                                            </a>
                                                                            <% } %>
                                                                                <% if (endPage < totalPages) { %>
                                                                                    <% if (endPage < totalPages - 1) {
                                                                                        %>
                                                                                        <span
                                                                                            class="px-3 py-1 font-roboto text-sm text-grey-900">...</span>
                                                                                        <% } %>
                                                                                            <a href="?page=<%= totalPages %>"
                                                                                                class="px-3 py-1 rounded-lg font-roboto text-sm bg-grey-200 text-grey-900 hover:bg-grey-300 min-h-[44px] flex items-center"
                                                                                                aria-label="Page <%= totalPages %>">
                                                                                                <%= totalPages %>
                                                                                            </a>
                                                                                            <% } %>
                                        </div>
                                        <a href="?page=<%= page < totalPages ? page + 1 : totalPages %>"
                                            class="w-full sm:w-auto bg-dark-blue-900 text-white px-3 py-2 rounded-lg hover:bg-dark-blue-800 transition-colors font-roboto text-sm min-h-[44px] text-center <%= page === totalPages ? 'opacity-50 cursor-not-allowed' : '' %>"
                                            aria-label="Next page">
                                            Next
                                        </a>
                                    </div>
                                    <% } %>

                                        <!-- Modal for Add/Update Media -->
                                        <div id="mediaModal"
                                            class="fixed inset-0 bg-black/50 flex flex-col justify-start item-center hidden modal z-50">
                                            <div
                                                class="bg-white dark:bg-dark-blue-800 rounded-xl p-4 sm:p-6 w-full max-w-[90%] sm:max-w-lg mx-auto my-4 sm:my-8 overflow-y-auto max-h-[calc(100vh-2rem)] scrollbar-thin scrollbar-thumb-grey-400 dark:scrollbar-thumb-dark-blue-600">
                                                <h2 id="modalTitle"
                                                    class="text-lg sm:text-2xl font-roboto font-bold text-dark-blue-900 dark:text-white mb-4">
                                                    Add Media</h2>
                                                <form id="mediaForm" action="/media" method="POST"
                                                    enctype="multipart/form-data" class="flex flex-col">
                                                    <input type="hidden" id="mediaId" name="id">
                                                    <div class="mb-4">
                                                        <label for="title"
                                                            class="block text-dark-blue-900 dark:text-grey-200 font-roboto text-sm mb-2">Title</label>
                                                        <input type="text" id="title" name="title"
                                                            class="w-full p-2 rounded-lg border border-grey-400 dark:border-dark-blue-600 bg-grey-100 dark:bg-dark-blue-900 text-dark-blue-900 dark:text-grey-200 font-roboto text-sm"
                                                            required>
                                                    </div>
                                                    <div class="grid grid-cols-2 gap-2">
                                                        <div class="mb-4">
                                                            <label for="author"
                                                                class="block text-dark-blue-900 dark:text-grey-200 font-roboto text-sm mb-2">Author</label>
                                                            <input type="text" id="author" name="author"
                                                                class="w-full p-2 rounded-lg border border-grey-400 dark:border-dark-blue-600 bg-grey-100 dark:bg-dark-blue-900 text-dark-blue-900 dark:text-grey-200 font-roboto text-sm">
                                                        </div>
                                                        <div class="mb-4">
                                                            <label for="description"
                                                                class="block text-dark-blue-900 dark:text-grey-200 font-roboto text-sm mb-2">Description</label>
                                                            <input id="description" name="description" type="text"
                                                                class="w-full p-2 rounded-lg border border-grey-400 dark:border-dark-blue-600 bg-grey-100 dark:bg-dark-blue-900 text-dark-blue-900 dark:text-grey-200 font-roboto text-sm"
                                                                required>
                                                        </div>
                                                    </div>
                                                    <div class="grid grid-cols-2 gap-2">
                                                        <div class="mb-4">
                                                            <label for="category"
                                                                class="block text-dark-blue-900 dark:text-grey-200 font-roboto text-sm mb-2">Category</label>
                                                            <input type="text" id="category" name="category"
                                                                class="w-full p-2 rounded-lg border border-grey-400 dark:border-dark-blue-600 bg-grey-100 dark:bg-dark-blue-900 text-dark-blue-900 dark:text-grey-200 font-roboto text-sm"
                                                                placeholder="e.g., Church Service">
                                                        </div>
                                                        <div class="mb-4">
                                                            <label for="type"
                                                                class="block text-dark-blue-900 dark:text-grey-200 font-roboto text-sm mb-2">Type</label>
                                                            <select id="type" name="type"
                                                                class="w-full p-2 rounded-lg border border-grey-400 dark:border-dark-blue-600 bg-grey-100 dark:bg-dark-blue-900 text-dark-blue-900 dark:text-grey-200 font-roboto text-sm"
                                                                required>
                                                                <option value="image">Image</option>
                                                                <option value="ebook">Ebook</option>
                                                                <option value="video">Video</option>
                                                                <option value="audio">Audio</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="grid grid-cols-2 gap-2">
                                                        <div class="mb-4">
                                                            <label for="file"
                                                                class="block text-dark-blue-900 dark:text-grey-200 font-roboto text-sm mb-2">File
                                                                (or link to video)</label>
                                                            <input type="file" id="file" name="file"
                                                                accept="image/*,audio/*,video/*,application/pdf,.epub,.mobi"
                                                                class="w-full p-2 rounded-lg border border-grey-400 dark:border-dark-blue-600 bg-grey-100 dark:bg-dark-blue-900 text-dark-blue-900 dark:text-grey-200 font-roboto text-sm">
                                                        </div>
                                                        <div class="mb-4">
                                                            <label for="image"
                                                                class="block text-dark-blue-900 dark:text-grey-200 font-roboto text-sm mb-2">Thumbnail</label>
                                                            <input type="file" id="image" name="image" accept="image/*"
                                                                class="w-full p-2 rounded-lg border border-grey-400 dark:border-dark-blue-600 bg-grey-100 dark:bg-dark-blue-900 text-dark-blue-900 dark:text-grey-200 font-roboto text-sm">
                                                        </div>
                                                    </div>
                                                    <div class="grid grid-cols-2 gap-2">
                                                        <div class="mb-4">
                                                            <label for="status"
                                                                class="block text-dark-blue-900 dark:text-grey-200 font-roboto text-sm mb-2">Status</label>
                                                            <select id="status" name="status"
                                                                class="w-full p-2 rounded-lg border border-grey-400 dark:border-dark-blue-600 bg-grey-100 dark:bg-dark-blue-900 text-dark-blue-900 dark:text-grey-200 font-roboto text-sm"
                                                                required>
                                                                <option value="active">Active</option>
                                                                <option value="inactive">Inactive</option>
                                                            </select>
                                                        </div>
                                                        <div class="mb-4">
                                                            <label for="tags"
                                                                class="block text-dark-blue-900 dark:text-grey-200 font-roboto text-sm mb-2">Tags
                                                                (comma-separated)</label>
                                                            <input type="text" id="tags" name="tags"
                                                                class="w-full p-2 rounded-lg border border-grey-400 dark:border-dark-blue-600 bg-grey-100 dark:bg-dark-blue-900 text-dark-blue-900 dark:text-grey-200 font-roboto text-sm"
                                                                placeholder="e.g., worship, sermon">
                                                        </div>
                                                    </div>
                                                    <div class="grid grid-cols-2 gap-2">
                                                        <div class="mb-4">
                                                            <label for="priceStatus"
                                                                class="block text-dark-blue-900 dark:text-grey-200 font-roboto text-sm mb-2">Price
                                                                Status</label>
                                                            <select id="priceStatus" name="priceStatus"
                                                                class="w-full p-2 rounded-lg border border-grey-400 dark:border-dark-blue-600 bg-grey-100 dark:bg-dark-blue-900 text-dark-blue-900 dark:text-grey-200 font-roboto text-sm"
                                                                required>
                                                                <option value="free">Free</option>
                                                                <option value="paid">Paid</option>
                                                            </select>
                                                        </div>
                                                        <div class="mb-4">
                                                            <label for="price"
                                                                class="block text-dark-blue-900 dark:text-grey-200 font-roboto text-sm mb-2">Price
                                                                ($)</label>
                                                            <input type="number" id="price" name="price" step="0.01"
                                                                class="w-full p-2 rounded-lg border border-grey-400 dark:border-dark-blue-600 bg-grey-100 dark:bg-dark-blue-900 text-dark-blue-900 dark:text-grey-200 font-roboto text-sm"
                                                                disabled>
                                                        </div>
                                                    </div>
                                                    <div class="flex justify-end gap-4">
                                                        <button type="button" id="closeModalBtn"
                                                            class="bg-grey-400 text-dark-blue-900 px-4 py-2 rounded-lg hover:bg-grey-500 font-roboto text-sm min-h-[44px]">Cancel</button>
                                                        <button type="submit"
                                                            class="bg-red-900 text-white px-4 py-2 rounded-lg hover:bg-red-800 font-roboto text-sm min-h-[44px]">Save
                                                            Media</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
            </main>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Sidebar Toggle
            const sidebar = document.getElementById('sidebar');
            const menuBtn = document.getElementById('menuBtn');

            menuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('-translate-x-full');
            });

            document.addEventListener('click', (e) => {
                if (!sidebar.contains(e.target) && !menuBtn.contains(e.target) && !sidebar.classList.contains('-translate-x-full')) {
                    sidebar.classList.add('-translate-x-full');
                }
            });

            // Modal and Form Handling
            const addMediaBtn = document.getElementById('addMediaBtn');
            const mediaModal = document.getElementById('mediaModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const mediaForm = document.getElementById('mediaForm');
            const modalTitle = document.getElementById('modalTitle');
            const mediaIdInput = document.getElementById('mediaId');
            const priceStatusSelect = document.getElementById('priceStatus');
            const priceInput = document.getElementById('price');
            const updateMediaBtns = document.querySelectorAll('.updateMediaBtn');
            const toggleStatusBtns = document.querySelectorAll('.toggleStatusBtn');
            const tableHeaders = document.querySelectorAll('th[data-sort]');
            const fileTypeInput = document.getElementById("type");
            const fileUploadInput = document.getElementById("file");

            // Toggle File Input
            function toggleFileInput() {
                if (fileTypeInput.value === "video") {
                    fileUploadInput.type = "url";
                    fileUploadInput.removeAttribute("accept");
                } else {
                    fileUploadInput.type = "file";
                    fileUploadInput.setAttribute("accept", "image/*,audio/*,video/*,application/pdf,.epub,.mobi");
                }
            }
            fileTypeInput.addEventListener('change', toggleFileInput);

            // Enable/disable price input
            function togglePriceInput() {
                priceInput.disabled = priceStatusSelect.value !== 'paid';
                if (priceInput.disabled) priceInput.value = '';
            }
            priceStatusSelect.addEventListener('change', togglePriceInput);

            // Open modal for adding media
            addMediaBtn.addEventListener('click', () => {
                modalTitle.textContent = 'Add Media';
                mediaForm.action = '/media';
                mediaForm.reset();
                mediaIdInput.value = '';
                document.getElementById('status').value = 'active';
                priceStatusSelect.value = 'free';
                togglePriceInput();
                toggleFileInput();
                mediaModal.classList.remove('hidden');
            });

            // Open modal for updating media
            updateMediaBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    modalTitle.textContent = 'Edit Media';
                    mediaForm.action = `/media/${btn.dataset.id}`;
                    mediaIdInput.value = btn.dataset.id;
                    document.getElementById('title').value = btn.dataset.title;
                    document.getElementById('description').value = btn.dataset.description || '';
                    document.getElementById('type').value = btn.dataset.type;
                    document.getElementById('status').value = btn.dataset.status;
                    document.getElementById('tags').value = btn.dataset.tags;
                    document.getElementById('category').value = btn.dataset.category || '';
                    document.getElementById('priceStatus').value = btn.dataset.priceStatus;
                    document.getElementById('price').value = btn.dataset.price;
                    document.getElementById('author').value = btn.dataset.author || '';
                    togglePriceInput();
                    toggleFileInput();
                    mediaModal.classList.remove('hidden');
                });
            });

            // Toggle media status
            toggleStatusBtns.forEach(btn => {
                btn.addEventListener('click', async () => {
                    const id = btn.dataset.id;
                    const newStatus = btn.dataset.status === 'active' ? 'inactive' : 'active';
                    try {
                        const response = await fetch(`/media/${id}/status`, {
                            method: 'PATCH',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ status: newStatus })
                        });
                        if (response.ok) {
                            btn.dataset.status = newStatus;
                            btn.closest('tr').querySelector('td:nth-child(4)').textContent = newStatus.charAt(0).toUpperCase() + newStatus.slice(1);
                        } else {
                            alert('Failed to toggle status');
                        }
                    } catch (error) {
                        alert('Error toggling status');
                    }
                });
            });

            // Close modal
            closeModalBtn.addEventListener('click', () => {
                mediaModal.classList.add('hidden');
            });

            // Close modal on outside click
            mediaModal.addEventListener('click', (e) => {
                if (e.target === mediaModal) {
                    mediaModal.classList.add('hidden');
                }
            });

            // Form submission validation
            mediaForm.addEventListener('submit', (e) => {
                const title = document.getElementById('title').value;
                const type = document.getElementById('type').value;
                const description = document.getElementById('description').value;
                const status = document.getElementById('status').value;
                const priceStatus = document.getElementById('priceStatus').value;
                const price = document.getElementById('price').value;
                if (!title || !description || !type || !status) {
                    e.preventDefault();
                    alert('Please fill out all required fields.');
                } else if (priceStatus === 'paid' && (!price || price <= 0)) {
                    e.preventDefault();
                    alert('Please enter a valid price for a paid media item.');
                }
            });

            // Table sorting
            let sortDirection = {};
            tableHeaders.forEach(header => {
                header.addEventListener('click', () => {
                    const key = header.dataset.sort;
                    sortDirection[key] = !sortDirection[key];
                    const tbody = header.closest('table').querySelector('tbody');
                    const rows = Array.from(tbody.querySelectorAll('tr'));
                    const index = Array.from(header.parentNode.children).indexOf(header) + 1;
                    rows.sort((a, b) => {
                        let aText, bText;
                        if (key === 'index') {
                            aText = parseInt(a.querySelector(`td:nth-child(${index})`).textContent);
                            bText = parseInt(b.querySelector(`td:nth-child(${index})`).textContent);
                            return sortDirection[key] ? aText - bText : bText - aText;
                        } else if (key === 'priceStatus') {
                            aText = a.querySelector(`td:nth-child(${index})`).textContent === 'Free' ? 0 : parseFloat(a.querySelector(`td:nth-child(${index})`).textContent.replace('$', ''));
                            bText = b.querySelector(`td:nth-child(${index})`).textContent === 'Free' ? 0 : parseFloat(b.querySelector(`td:nth-child(${index})`).textContent.replace('$', ''));
                            return sortDirection[key] ? aText - bText : bText - aText;
                        } else {
                            aText = a.querySelector(`td:nth-child(${index})`).textContent;
                            bText = b.querySelector(`td:nth-child(${index})`).textContent;
                            return sortDirection[key] ? aText.localeCompare(bText) : bText.localeCompare(aText);
                        }
                    });
                    tbody.innerHTML = '';
                    rows.forEach(row => tbody.appendChild(row));
                });
            });
        });
    </script>
</body>

</html>